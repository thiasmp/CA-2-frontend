{"ast":null,"code":"var URL='http://localhost:8080/CA2_Backend';function handleHttpErrors(res){if(!res.ok){return Promise.reject({status:res.status,fullError:res.json()});}return res.json();}var apiFacade=function apiFacade(){var fetchData=function fetchData(endpoint,updateAction,SetErrorMessage){var options=makeOptions('GET',true);//True add's the token\nreturn fetch(URL+'/api/'+endpoint,options).then(handleHttpErrors).then(function(data){return updateAction(data);}).catch(function(err){if(err.status){console.log(err);err.fullError.then(function(e){return SetErrorMessage(e.code+': '+e.message);});}else{SetErrorMessage('Network error');}});};var login=function login(user,password,setLoggedIn,setErrorMessage){var options=makeOptions('POST',true,{username:user,password:password});return fetch(URL+'/api/login',options).then(handleHttpErrors).then(function(res){setToken(res.token);setLoggedIn(true);setErrorMessage('Logged in');}).catch(function(err){if(err.status){err.fullError.then(function(e){return setErrorMessage(e.code+': '+e.message);});}else{setErrorMessage('Network error');}});};// Security funktionalitet\nvar setToken=function setToken(token){localStorage.setItem('jwtToken',token);};var getToken=function getToken(){return localStorage.getItem('jwtToken');};var loggedIn=function loggedIn(){var loggedIn=getToken()!=null;return loggedIn;};var logout=function logout(){localStorage.removeItem('jwtToken');};var getUserRoles=function getUserRoles(){var token=getToken();if(token!=null){var payloadBase64=getToken().split('.')[1];var decodedClaims=JSON.parse(window.atob(payloadBase64));var roles=decodedClaims.roles;return roles;}else return'';};var hasUserAccess=function hasUserAccess(neededRole,loggedIn){var roles=getUserRoles().split(',');return loggedIn&&roles.includes(neededRole);};var makeOptions=function makeOptions(method,addToken,body){var opts={method:method,headers:{'Content-type':'application/json',Accept:'application/json'}};if(addToken&&loggedIn()){opts.headers['x-access-token']=getToken();}if(body){opts.body=JSON.stringify(body);}return opts;};return{makeOptions:makeOptions,fetchData:fetchData,setToken:setToken,getToken:getToken,loggedIn:loggedIn,login:login,logout:logout,getUserRoles:getUserRoles,hasUserAccess:hasUserAccess};};var facade=apiFacade();export default facade;","map":{"version":3,"sources":["C:/Users/thias/Desktop/CA-2/CA2-frontend/src/facade.js"],"names":["URL","handleHttpErrors","res","ok","Promise","reject","status","fullError","json","apiFacade","fetchData","endpoint","updateAction","SetErrorMessage","options","makeOptions","fetch","then","data","catch","err","console","log","e","code","message","login","user","password","setLoggedIn","setErrorMessage","username","setToken","token","localStorage","setItem","getToken","getItem","loggedIn","logout","removeItem","getUserRoles","payloadBase64","split","decodedClaims","JSON","parse","window","atob","roles","hasUserAccess","neededRole","includes","method","addToken","body","opts","headers","Accept","stringify","facade"],"mappings":"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","sourcesContent":["const URL = 'http://localhost:8080/CA2_Backend';\r\n\r\nfunction handleHttpErrors(res) {\r\n  if (!res.ok) {\r\n    return Promise.reject({ status: res.status, fullError: res.json() });\r\n  }\r\n  return res.json();\r\n}\r\n\r\nlet apiFacade = () => {\r\n  const fetchData = (endpoint, updateAction, SetErrorMessage) => {\r\n    const options = makeOptions('GET', true); //True add's the token\r\n    return fetch(URL + '/api/' + endpoint, options)\r\n      .then(handleHttpErrors)\r\n      .then((data) => updateAction(data))\r\n      .catch((err) => {\r\n        if (err.status) {\r\n          console.log(err);\r\n          err.fullError.then((e) => SetErrorMessage(e.code + ': ' + e.message));\r\n        } else {\r\n          SetErrorMessage('Network error');\r\n        }\r\n      });\r\n  };\r\n\r\n  const login = (user, password, setLoggedIn, setErrorMessage) => {\r\n    const options = makeOptions('POST', true, {\r\n      username: user,\r\n      password: password,\r\n    });\r\n    return fetch(URL + '/api/login', options)\r\n      .then(handleHttpErrors)\r\n      .then((res) => {\r\n        setToken(res.token);\r\n        setLoggedIn(true);\r\n        setErrorMessage('Logged in');\r\n      })\r\n      .catch((err) => {\r\n        if (err.status) {\r\n          err.fullError.then((e) => setErrorMessage(e.code + ': ' + e.message));\r\n        } else {\r\n          setErrorMessage('Network error');\r\n        }\r\n      });\r\n  };\r\n\r\n  // Security funktionalitet\r\n\r\n  const setToken = (token) => {\r\n    localStorage.setItem('jwtToken', token);\r\n  };\r\n  const getToken = () => {\r\n    return localStorage.getItem('jwtToken');\r\n  };\r\n  const loggedIn = () => {\r\n    const loggedIn = getToken() != null;\r\n    return loggedIn;\r\n  };\r\n  const logout = () => {\r\n    localStorage.removeItem('jwtToken');\r\n  };\r\n\r\n  const getUserRoles = () => {\r\n    const token = getToken();\r\n    if (token != null) {\r\n      const payloadBase64 = getToken().split('.')[1];\r\n      const decodedClaims = JSON.parse(window.atob(payloadBase64));\r\n      const roles = decodedClaims.roles;\r\n      return roles;\r\n    } else return '';\r\n  };\r\n\r\n  const hasUserAccess = (neededRole, loggedIn) => {\r\n    const roles = getUserRoles().split(',');\r\n    return loggedIn && roles.includes(neededRole);\r\n  };\r\n\r\n  const makeOptions = (method, addToken, body) => {\r\n    var opts = {\r\n      method: method,\r\n      headers: {\r\n        'Content-type': 'application/json',\r\n        Accept: 'application/json',\r\n      },\r\n    };\r\n    if (addToken && loggedIn()) {\r\n      opts.headers['x-access-token'] = getToken();\r\n    }\r\n    if (body) {\r\n      opts.body = JSON.stringify(body);\r\n    }\r\n    return opts;\r\n  };\r\n\r\n  return {\r\n    makeOptions,\r\n    fetchData,\r\n    setToken,\r\n    getToken,\r\n    loggedIn,\r\n    login,\r\n    logout,\r\n    getUserRoles,\r\n    hasUserAccess,\r\n  };\r\n};\r\n\r\nconst facade = apiFacade();\r\n\r\nexport default facade;\r\n"]},"metadata":{},"sourceType":"module"}